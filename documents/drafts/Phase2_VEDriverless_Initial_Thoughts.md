# Initial Thoughts on Phase 2 Driverless Additions to VE
### September 14, 2020
### Revised October 8, 2020
### Brian Gregor

## Introduction
This memo documents initial thoughts on addressing desired additions for modeling driverless vehicles in VisionEval.

### Overview of Relevant VisionEval Modules
The VE modules calculate household DVMT and its effects in 2 stages. In the first stage, a regression model is applied to calculate a base-level quantity as a function of each household's characteristics and the characteristics of the place where it is located. The numbers of household vehicles, drivers, and children age 0-14 are key variables related to this item in both the original CalculateHouseholdDVMT module in the VEHouseholdTravel package <sup>[1](#footnote1)</sup> and the newer CalculateHouseholdDVMT module in the VETravelDemandMM package <sup>[2](#footnote2)</sup>. The newer module also as includes persons 65 years old or older as a variable. The In the second stage, the cost of operating household vehicles and using car services is calculated and the household DVMT is adjusted to fit within the household vehicle operating cost budget. 

#### Calculating Base-Level Household DVMT
The calculation of the base-level household DVMT depends on the outputs of other modules that:  
- Calculate the numbers of drivers in each household;  
- Calculate an initial number of vehicles owned by each household; 
- Create a vehicle table and assign characteristics of owned vehicles and car services;
- Calculate the cost of owning each household vehicle; and,
- Adjust the number of vehicles owned based on the availability car services and relative cost.  

The AssignDrivers module in the VEHouseholdVehicles package calculates the number of drivers in the household in each of the driving age groups (15-19, 20-29, 30-54, 55-64, 65+). The model is a binary logit model that is applied to each household person to determine whether the person is a driver. Key variables include the person's age group, whether the person is a worker, the household size, the household income, whether the household resides in a single-family dwelling, the population density and mixed-use character of the neighborhood, and the transit service level. The module allows users to adjust driver licensing rates by age group with values in the *region_hh_ave_driver_per_capita.csv* input file. When values are assigned, the module adjusts the application of the binary logit model so that the assigned values are matched.

The AssignVehicleOwnership module in the VEHouseholdVehicles package makes an initial calculation of the number of vehicles owned by the household (owned vehicles includes vehicles that are leased). The model has two parts. The first part is a binary logit model which determines whether the household owns no vehicles. The second part is an ordered logit model which determines how many vehicles are owned. Key variables in the binary logit model include the number of drivers, number of workers, income, whether the household resides in a single-family dwelling, neighborhood density and mixed-use character, and transit service level. Key variables in the ordered logit model are similar but also include whether all household members are elderly (age 65 or older). The module allows users to adjust vehicle ownership rates by azone with values in the *azone_hh_ave_veh_per_driver.csv* input file. When values are assigned, the module adjusts the application of the binary logit model so that the assigned values are matched.

The CreateVehicleTable module in the VEHouseholdVehicles package creates a table to store the characteristics and impacts of using household vehicles. In addition to creating entries for each of the vehicles owned by households, it creates entries for car services that may be used by each household. There as many entries for each household as there are driving age persons in the household (persons 15 years old or older). There is a record for each vehicle owned by the household. If there are more driving age persons than vehicles owned, the remaining records are identified as the level of car service available to the household (low or high)<sup>[3](#footnote3)</sup>. The *VehicleAccess* field in the table identifies each household 'vehicle' as either *Own*, *LowCarSvc*, or *HighCarSvc*. 

The CalculateVehicleOwnCost module in the VEHouseholdVehicles package estimates the annual cost of owning each household vehicle and converts that into per mile cost assuming that household DVMT<sup>[4](#footnote4)</sup> is allocated equally among all vehicles owned by the household. Vehicle ownership costs include residential parking cost, vehicle depreciation, financing, licensing/registration/taxes, and insurance. Residential parking costs are the cost of parking the vehicle at the residence. This is calculated by the *AssignParkingRestrictions* module in the VELandUse and VESimLandUse packages. Vehicle depreciation is calculated as a function of vehicle type and age. Financing cost is calculated as a function of vehicle age. Licensing/registration/taxes are calculated based on user inputs in the *azone_hh_veh_own_taxes.csv* file. Insurance is calculated as a function of vehicle type. The module also includes a model for assigning pay-as-you-drive (PAYD) insurance to households based on targets included in the *azone_payd_insurance_prop.csv* input file and a model which assigns relative probabilities that a household would use PAYD insurance that are a function of the mileage, income, driver ages, vehicle type, and location (metropolitan vs. non-metropolitan). For households that are identified as PAYD households, the insurance costs are not identified as ownership costs but are instead calculated as operating costs (see below).

The AdjustVehicleOwnership module in the VEHouseholdVehicles package adjusts the number of vehicles owned as a function of the estimated cost per mile of owning each of the household's vehicles and the availability and cost of using high-level car service. A household vehicle is considered to be a candidate for elimination in favor of using high-level car service if the per mile cost of ownership is greater than the per mile cost of using the car service. If a household vehicle is identified as a candidate for substitution, whether or not a substitution is made depends on user assumptions for the likelihood that such a substitution is made contained in the *LtTrkCarSvcSubProp* and *AutoCarSvcSubProp* fields of the *azone_carsvc_characteristics.csv* input file. These fields specify assumptions for the respective proportions of light-trucks and autos that owners would substitute high-level car service if less expensive. These proportions are used as probabilities that are assigned randomly to all candidate vehicles.

The AdjustVehicleOwnership module also calculates that number of vehicles that are used in the base calculation of household DVMT (by the CalculateHouseholdDVMT module). Where high level car service is not available to the household, the number of vehicles is the number of vehicles owned by the household. Where high level car service is available, the number of vehicles is equal to the number of driving-age persons in the household.

#### Adjusting Household DVMT and Calculating Effects
The adjustment of base household DVMT and calculating its effects is primarily determined by modules that: 
- Calculate roadway VMT;
- Calculate congestion levels and apply congestion taxes;
- Calculate fuel economy;
- Calculate vehicle operating costs and allocate DVMT among household vehicles;
- Calculate the household vehicle operating cost budget and adjust household DVMT to fit the budget if necessary; and,  
- Calculate vehicle tax collection and adjust if taxes are insufficient to pay for road costs.  

These modules are iterated several times to account for their effects on each other.

The CalculateRoadDvmt module calculates the DVMT assigned to roadways in the urbanized area of each marea and in non-urbanized areas. This is done for household DVMT, commercial service vehicle<sup>[5](#footnote5)</sup> DVMT, heavy truck DVMT and bus DVMT.

The CalculateRoadPerformance module allocates DVMT to 3 roadway classes: local, arterial, freeway. Light-duty vehicle DVMT and heavy-duty vehicle DVMT are assigned in different ways. Heavy-duty DVMT (heavy trucks and buses) are assigned according to fixed percentages input by the user for the urbanized area. Light-duty DVMT on local roads is assigned similarly but light-duty DVMT is split between arterials and freeways using an aggregate equilibrium model that is responsive to congestion, operations programs that mitigate congestion (e.g. ramp metering), and congestion pricing. Among other things, the module computes the urban and non-urban road speeds by vehicle type by marea and average congestion pricing cost per vehicle mile by marea.

The CalculateMpgMpkwhAdjustments module calculates adjustments to vehicle fuel efficiency (miles per gallon) and electric power efficiency (miles per kilowatt-hour) by vehicle type (light-duty vs. heavy duty) and powertrain (ICEV, HEV, BEV) for each marea as a function of calculated speeds as well as operations programs which smooth traffic flow (reduce speed fluctuations). The AdjustHhVehicleMpgMpkwh adjusts each household fuel efficiency based on the marea the household resides in, the powertrain type of the vehicle, the relevant adjustment factors calculated by the CalculateMpgMpkwhAdjustments module, and whether the household practices eco-driving. It should be noted that vehicle powertrain types and base level efficiencies are assigned by the *AssignHhVehiclePowertrain* module in the *VEPowertrainsAndFuels* package. Whether or not a household practices eco-driving is assigned randomly using probabilities specified by the user in the *marea_speed_smooth_ecodrive.csv* input file.

The CalculateHhVehicleOperatingCosts module calculates the per mile cost of operating each household vehicle and the per mile cost for using car services. The household operating cost includes:  
- Maintenance/repair/tire cost calculated by a model;
- Energy cost calculated by fuel and electric power consumption per mile calculated by the *AdjustHhVehicleMpgMpkwh* module and the fuel cost and electricity cost that are user inputs (*azone_fuel_power_cost.csv* input file);
- Parking cost, not including residential parking cost (which is an ownership cost), calculated by the *AssignParkingRestrictions* module;
- PAYD insurance cost for households identified as having PAYD insurance;
- Vehicle use taxes which include fuel taxes (and equivalent vehicle use taxes when specified by the user), vehicle mileage taxes, and congestion fees. Tax rates are specified in the *azone_veh_use_taxes.csv* input file;
- Other social/environmental impact fees. Users specify carbon pollution cost per metric ton in the *region_co2e_costs.csv* input file. Other social/environmental unit costs (air pollution, other resource, energy security, safety, noise) are model parameters. The proportions of carbon costs and other costs assigned to vehicle travel are specified by the user in the *region_prop_externalities_paid.csv* input file.  

The cost of using car services is calculated using the per-mile rates specified by the user in the *azone_carsvc_characteristics.csv* input file.

After calculating the per mile operating cost for each household vehicle, the module allocates travel among household vehicles. Travel is allocated among vehicles as a function of the per mile composite cost of operation of each vehicle using a Cobb-Douglas utility function. The composite cost is the sum of the travel time cost and the operating cost. Average travel time cost per mile is calculated from the average travel rate (hours per mile) and the user specified value for value of time (dollars per hour). The average travel rate is calculated from the average speed (previously calculated), average miles per vehicle trip (calculated from DVMT and vehicle trips previously calculated), and access time per trip (user inputs in the *azone_vehicle_access_times.csv* file). Once household DVMT is allocated among vehicles, an average operating cost per mile for household travel is calculated. 

The BudgetHouseholdDvmt calculates the vehicle operating cost budget for each household and adjusts household DVMT to fit within the budget. First the module applies a model to calculate the maximum proportion of household income to allocate for vehicle operating cost as a function of the the household income. Then the module makes adjustments to income to reflect ownership cost savings which the household is assumed to allocate to it's operating cost budget. These savings include annual insurance cost if the household is PAYD and reduced vehicle ownership cost if the household has reduced vehicle ownership in favor of using car service. The adjusted income is multiplied by the maximum proportion of income allocated to vehicle operation to calculate the vehicle operating cost budget. The base level household DVMT is calculated by calling the CalculateHouseholdDVMT module and multiplied by the average operating cost per mile to calculate household vehicle operating cost. If the household vehicle operating cost is greater than the operating cost budget, the household DVMT is reduced proportionally so that the budget is not exceeded.

The BalanceRoadCostsAndRevenues module is an optional module that calculates if additional vehicle mile taxes are needed in order to pay for planned roadway expansions and other road costs. Input assumptions for freeway lane-miles and arterial lane-miles by marea and year are contained in the *marea_lane_miles.csv* input file. From these inputs, the module calculates an average annual rates of adding freeway and arterial lane-miles per year. The unit costs for adding freeway and arterial lane-miles are specified by the user in the *region_road_cost.csv* input file. The annual road expansion cost is calculated from the annual expansion rates and unit costs. Road expansion costs are allocated to households in proportion to the passenger car equivalents (PCE) of household vehicle travel to all vehicle travel where the PCE of household and commercial service vehicle travel is 1 and the PCE of heavy vehicle travel is specified by the user in the *region_road_cost.csv* input file. Other road costs (RoadBaseModCost, RoadPresOpMaintCost, RoadOtherCost) are calculated for household travel using user specified rated in the *region_road_cost.csv* input file and total household DVMT. Total road costs are compared to total road taxes computed by the CalculateHhVehicleOperatingCosts module. If the total road costs of household travel exceed total road taxes, the module computes a vehicle mileage tax surcharge necessary for revenues to equal costs. This surcharge is added to the other road taxes in subsequent modules iterations.

#### Rudimentary Capabilities of the VisionEval Model to Address Driverless Vehicles
The VisionEval models address a few of the potential effects of driverless vehicles on travel. Users can simulate the effects of the deployment of driverless vehicles in car services on vehicle ownership and relative car service use. Users can change the car service prices and service levels to reflect the effects of deploying driverless vehicles (which should lower labor costs, thus lowering prices and increasing service levels). The model adjusts vehicle ownership and the effective number of vehicles available as a function of car service prices. It also adjusts the relative use of car services as a function of relative car service prices.

### Phase 1 Driverless Vehicle Additions
Phase 1 of work to address the potential effects of driverless vehicles incorporated changes to model the following:  
1. Effect of driverless vehicles on highway capacity and emissions: Researchers have estimated that widespread deployment of connected autonomous vehicles could substantially increase highway capacity as a result of better harmonized traffic flows, shorter headways, and lower crash rates. More harmonized traffic flows will also result in lower emissions (for internal combustion engine vehicles) because less fuel will be wasted due to operation at more constant traffic speeds.  
2. Effect of driverless vehicles on distance traveled: The use of driverless vehicles may increase the distances that people are willing to travel because vehicle travel is made less onerous. Travelers can spend their time doing more enjoyable or productive things than driving their vehicles.  
3. Effect of driverless vehicles on unoccupied vehicle trips: Driverless vehicles will enable and perhaps encourage trips to be made that are now not possible. Having a driverless vehicle may make it possible for a traveler to avoid parking difficulties and/or fees by sending the vehicle to a more remote location to park (such as sending it back home) or by having the vehicle circulate in taffic until it is needed. In addition, for car services (driverless or not) deadhead travel needs to be accounted for.  

Following is a summary of revisions made to modules to address these effects.

#### CreateVehicleTable Module
Among other things, this module processes the car service inputs in the *azone_carsvc_characteristics.csv* file. This file is modified to include factors which specify deadhead proportions for high level car service and for low level car service (HighCarSvcDeadheadProp, LowCarSvcDeadheadProp) by Azone and year. Deadhead proportion is defined as deadhead mileage divided by fare mileage.

#### AssignDriverlessVehicles Module  
This is a new module which assigns household vehicles as driverless or not and also identifies the proportions of the VMT of other vehicles (car service, commercial service, heavy truck, public transit) that are driverless. Driverless vehicle inputs are specified by the user in the *region_driverless_vehicle_prop.csv* file in 5 or 10 year intervals. The values for household vehicles represent the proportion of vehicles sold that are driverless. Separate inputs are specified for autos and light trucks. The values for other vehicles represent the proportions of vehicle travel that are driverless.  

Household vehicles are identified as driverless as a function of the vehicle type (auto, light truck) and age. The proportion of vehicles by vehicle model year and type are calculated by the model run year and interpolation of values in the input file. This provides the probabilities that each household vehicle is driverless given its type and age. A random draw based on this probability determines whether the vehicle is driverless.

#### CalculateRoadDvmt Module
This module is modified to calculate the proportions of light-duty vehicle, heavy truck, and bus DVMT that are driverless. These values are computed using the driverless vehicle proportion inputs and the respective proportions of road travel by each vehicle type.

#### CalculateRoadPerformance Module
The CalculateRoadPerformance module is modified to account for the effect of driverless vehicle travel on travel speeds. This is done by using the *other_ops_effectiveness.csv* file (which exists to model the effects of operations programs other than ramp metering, incident management, signal coordination, and access management on speed) to specify expected delay reductions when all travel is by driverless vehicles. Percentage reductions in recurring and nonrecurring congestion delay on freeways and on arterials are specified at each of 5 congestion levels (none, moderate, heavy, severe, extreme). The delay reduction at a given driverless VMT proportion is calculated as:
`DelayReduction = MaxDelayReduction * DriverlessVmtProportion ^ Beta`
where *Beta* is a parameter which determines the marginal change in delay reduction with each increase in the driverless DVMT proportion. It is expected that the marginal change rate will accelerate as the driverless VMT proportion increases. This is modeled with a Beta value greater than 1. The value of Beta is specified in the *driverless_effect_adj_param.csv* input file.
The module is modified to calculate the delay reductions given the estimated proportion of DVMT that is driverless and to apply those delay reductions to calculate vehicle speeds by congestion level where those delay reductions are greater than delay reductions calculated to result from ramp metering, incident management, signal coordination, and access management deployments specified by the user.

#### CalculateMpgMpkwhAdjustments Module
The CalculateMpgMpkwhAdjustments module is modified to account for the effect of driverless vehicles on smoothing traffic flows (i.e. reducing speed variation). The modifications build on the existing speed smoothing model which estimates the maximum possible level of speed smoothing. It is assumed that this maximum effect would occur when all VMT is driverless. The effect at a given driverless VMT proportion is calculated as:
`SmoothEffect = MaxSmoothEffect * DriverlessVmtProportion ^ Beta`
where *Beta* is the same value that is used in the CalculateRoadPerformance module to represent how the marginal change in driverless VMT affects the marginal change in speed smoothing and the effect on fuel economy.

#### CalculateVehicleOperatingCost Module  
The CalculateVehicleOperatingCost module is modified to account for several anticipated effects of driverless vehicles on the allocation of household VMT to vehicles in the household and to adjust vehicle VMT to account for the effect of using a driverless vehicle on the amount of vehicle travel.  

The allocation of VMT among household vehicles is modified to account for driverless vehicles being less onerous to operate and to account for users of driverless vehicles to be able to avoid parking charges. User input values for RunTimeUtilityAdj and AccessTimeUtilityAdj specify the relative perception of time by users of driverless vehicles for travel in the vehicle and access to and from the vehicle. For example a RunTimeUtilityAdj value of 0.8 means that a driverless vehicle user would percieve a 1 hour trip to be no more onerous than a 48 minute trip in a non-driverless vehicle. The AccessTimeUtilityAdj factor might be less than 1 if it is assumed that driverless vehicles can be summoned remotely from their parking location to the user, making accessing the vehicle less onerous. The potential for avoiding parking charges is specified by the user-specified PropParkingFeeAvoid factor which specifies the proportion of parking fees avoided for travel in owned driverless vehicles. The user specifies the values of these factors by year in the *region_driverless_vehicle_parameter.csv* input file.  

After household VMT is allocated to vehicles, adjustments are made to the amount of VMT assigned to household driverless vehicles and to car service travel to account for increased usage and deadheading. To account for the effect of more pleasant travel in a driverless vehicle on the amount of travel, the composite costs of travel by each driverless vehicle with and without accounting for the run time and access time utility adjustments are calculated and the resulting ratio of costs is used to adjust the driverless vehicle VMT. To account for the effect of remote vehicle operation (e.g sending/fetching a vehicle to a free parking space at a more distant location) on VMT, the module calculates added VMT using user supplied assumptions for the proportion of trips using a driverless vehicle that include remotely accessing the vehicle (PropRemoteAccess) and the average proportional adjustment to driverless vehicle VMT when remotely accessed (RemoteAccessDvmtAdj). These values are specified by year in the *region_driverless_vehicle_parameter.csv* input file. The additional VMT due to remote vehicle access is calculated as follows:
`AddRemoteAccessDvmt_Ve <- Dvmt_Ve * PropRemoteAccess * RemoteAccessDvmtAdj`
Added car service DVMT due to deadheading is accounted for by applying a deadheading proportion that is specified by the user for each car service level (see above).

Average costs and impacts attributable to household travel are calculated using the adjusted vehicle VMT. The average out-of-pocket costs are calculated considering the new totals except for the added deadhead VMT of car service vehicles (since households don't pay for the deadhead miles). Social/environmental costs are calculated considering all the new totals including the deadhead miles.  Road use taxes also are calculated considering all new totals including deadhead miles. The total VMT is summed up for each household. In addition, the ratio of household deadhead miles to total VMT and the ratio of added driverless miles to total VMT are calculated and saved. These ratios are used in subsequent iterations of this module to adjust the household VMT so as to avoid double counting. The deadhead ratio is also used in the BudgetHouseholdDvmt module to remove VMT that the household doesn't pay for when calculating the household's total operating cost expenditures.

#### BudgetHouseholdDvmt Module
The BudgetHouseholdDvmt module is modified so that it uses the household's total DVMT calculated by the CalculateVehicleOperatingCost module rather than running the CalculateHouseholdDVMT module to calculate it. The total household DVMT is adjusted using the deadhead ratio (see above) to calculate the VMT that the household pays for. That quantity is multiplied by the average operating cost per mile to calculate the total operating cost used in the budget calculation. The household budget is calculated as described above, and if the total operating cost exceeds the budget, the total DVMT (not including the deadhead DVMT) is adjusted downward to match the budget. A new total DVMT including the deadhead portion is recalculated using the deadhead ratio.

## Plan for Phase 2 Driverless Vehicle Additions

### Desired Enhancements 
Following is the list of desired enhancements as presented in the wiki for the OregonDOT-VisionEval GitHub repository. The first 2 are the highest priority for ODOT to include in the model.
1. Enable non-drivers to become drivers with driverless cars (e.g., youth and eldery). Dial to change drivers rate in AssignDrivers module (or simply use region_hh_driver_adjust_prop.csv), and possibly other implications. Source for how much these populations would drive?
2. Occupancy dials for owned and CarService vehicles.  Current model implicitly assumes NHTS average occupancy, allow user to change this value.  How identify base value and source for reasonable alternative occupancy range?
3. Inputs limiting “driverless” to selected powertrains.  This might be an easy non-combustion engine toggle, or expanding the planned 2 value input to 6.
4. Add a driverless vehicle maintenance (per mile) operating cost surcharge.  This would reflect the cost to keep the software and AV technology in top condition.  Source for additional costs?
5. Tabulate/enable output measure of overall Car Service impact to lend realism.  Identify total and share of car service miles, number of households using Car Service (currently able?) and/or the number of CarService vehicles (i.e., for parking demands)
6. Car Service rate structure – add fixed rate to per mile rate.
7. Allow policy that taxes zero-passenger vehicle miles (owned or CarService). Would require separating out base amount of zero-passenger miles, and an ability to substitute between zero and non-zero miles. For car services, zero-passenger miles are miles traveled without a customer (same as deadhead miles). For owned vehicles, zero-passenger miles are miles traveled without any occupants.
8. Expand the revenue generation reporting from the model.  Sources and amounts. (could do much with existing outputs, might also need to save intermediate outputs)  
9. Replace random assignment of which HHs get AVs. Current input is X% of vehicles are AV in model year XXXX. Borrow HH index trick from PAYD module, where HH attributes weight the likelihood of the AV assignment. (e.g., given input that 5% vehicles made in 2030 are assumed AV, index gives higher probability that AVs go to EV vehicles of that year and HHs with teenagers, and longer commutes, exact attributes in index determined by lit review/survey data).
10. Be able to consider (model) varying shared price schemes such as:
  - Per mile charge
  - Public-private shared model, where TNCs help to supplement or replace transit with the option at a flat / subsidized fare.
  - Subscription plans with unlimited miles.

The following sections present initial thoughts on how (and whether) each of these additions could be made. The presentation generally follows the order of the list, but in some cases items have been combined because they can be addressed using the same mechanism.

### Item 1: Enable non-drivers to become drivers with driverless vehicles
> Enable non-drivers to become drivers with driverless cars (e.g., youth and eldery). Dial to change drivers rate in AssignDrivers module (or simply use region_hh_driver_adjust_prop.csv), and possibly other implications. Source for how much these populations would drive?

#### Discussion
The existing model code along with the Phase 1 modifications enable most driverless vehicle effects to be modeled by adjusting various model input parameters to adjust travel. This approach is used because driverless cars are not in use and therefore their effects on vehicle travel are rather speculative. The most that can be done at the present time is to model driverless vehicles is to account for the various aspects of how driverless vehicles are assumed to affect travel and have input factors which enable users to parameterize the magnitude of effect of each aspect. Following is a review Phase 1 model code capabilities and limitations for addressing the effects of driverless vehicles on the travel of young people and the elerly. The effects of driverless vehicles in the deployment of car services is addressed first followed by the effects of driverless vehicles owned by households.

Driverless vehicles can affect the cost and availability of high level car service. This in turn affects household vehicle ownership and car availability. Sections above describe how these effects are currently modeled. Users make input assumptions on how driverless vehicles could affect the cost and availability of high level car service. Given these assumptions, the model adjusts vehicle ownership and vehicle availability. Vehicle availability for households having high level car service availability is increased to equal the number of driving age persons. This affects the outputs of the regression model which calculates base level household VMT since the model is sensitive to vehicle availability. Because youth older than 14 and the elderly are of driving age, this approach addresses the potential of increased vehicle travel by those age cohorts due to greater household vehicle availability. Since vehicle availability is not increased for children younger than 15, the model does not have the same direct effect on vehicle travel attributable to them. However, it should be noted that the household DVMT regression model includes number of persons age 0-14 as a variable with a positive coefficient. Therefore increasing vehicle availability for a household that has younger children will result in a greater increase in travel than that for a household that does not include younger children.

It should be noted that the effect of the availability of high level car service on household vehicle travel is accounted for only by adjusting the number of vehicles supplied to the regression model. The number of drivers is also an input to that model, but that input is not changed. It could be argued that not changing the driver input results in an underestimation of the effect of high car service availability on household vehicle travel. If that is thought to be the case, then users can make assumptions for how driverless vehicle services increase 'drivers' by adjusting the values in the *region_hh_ave_driver_per_capita.csv* input file.  While this would increase drivers by age group, it would not allocate the increase to households living in places where high level car service is available. To do that, it would be necessary to have a different set of driver rate inputs for those places and then modify the code in the AssignDrivers module to handle the application of the 2 sets of inputs. Before doing that, however, tests should be run using the existing model to determine whether the existing approach of adjusting vehicle availability is sufficient for modeling the anticipated effect of driverless car services on household vehicle travel. 

While it could be argued that model adequately addresses the effects of driverless car services on travel by the elderly and non-driving-age youth (with the appropriate inputs), it is clear that the model does not address how driverless vehicle ownership could affect vehicle travel attributable to non-driving-age youth or the elderly. With regard to the younger population, it can be argued that the VMT resulting from their activities is already accounted for in household VMT estimates because they are being chauffered by other household members. Moreover, it could be argued that the chauffering of younger children increases the amount of household travel over what would occur is they could travel independently in a driverless vehicle. That argument is supported by the presence of the 0-14 age group count variable having a positive coefficient in the household DVMT regression model. The model calculates lower VMT for households having driving-age children than for households having non-driving-age children (all else equal). The difference is likely to primarily be due to increased travel necessary to chauffer non-driving-age children. Therefore, it is possible that owning a driverless vehicle would decrease, not increase, household travel if non-driving-age children in the household are allowed to travel independently. It is also very uncertain how many parents would allow their younger children to travel independently. For these reasons it is probably not justifiable making any model modifications to address the effect of driverless vehicle ownership on vehicle travel attributable to younger children.

Modeling the potential effects of driverless vehicles on vehicle ownership and travel by the elderly can not be as easily dismissed. Many elderly persons stop driving when they are incapable of driving or no longer feel sufficiently confident with their abilities. Diminished driving capabilities, even if they don't cause an elderly person to stop driving, affect when, where, and how much that person drives. Owning a driverless vehicle would enable those persons who can't drive to travel independently by car. It also may increase the amount of vehicle travel by elderly persons who can drive. 

### Recommendations
No changes are recommended to address how driverless ownership might change the vehicle travel of households having younger children.

Changes can be made to existing modules to model some of the effects of driverless vehicle ownership on vehicle travel by the elderly. Following is an outline of possible changes:
1. The effect of driverless vehicles on increased vehicle ownership by the elderly can be accounted for by adjusting the vehicle ownership rate for persons 65 or older in the *azone_hh_ave_veh_per_driver.csv* file. Guidance needs to be provided on how this should be done.
2. The AssignDriverlessVehicles module can be modified using the mechanism discussed below for item #3 and #9 to establish some preference for assigning driverless vehicles to elderly households.
3. The AssignDriverlessVehicles module can be modified to update driver attributes previously set by the AssignDrivers module so that all elderly persons in households owning driverless vehicles are identified as drivers.  
These changes would address most of the effects of driverless vehicles on travel by elderly persons. They would not address the potential for increased travel by the elderly due to reduced travel anxiety. Accounting for that effect would likely require reestimating the household DVMT model to expose a variable that can be changed to approximate this effect.

Model testing needs to be done to determine whether the existing method of for modeling driverless car services is sufficiently sensitive and to develop user recommendations for sensible input values. Tests can be run using the RVMPO test platform which represents a model area that is large enough to include a variety of conditions but small enough to run quickly. For simplicity sake, the tests can be run assuming that high level car service is available everywhere in the region. The tests can be run with different assumptions about how driverless services affect car service costs and how they affect driver proportions in the *region_hh_driver_adjust_prop.csv* file. The results can be used to investigate:
- The relative effects of number of vehicles and number of drivers on base household VMT
- The sensitivity of base household VMT to car-service pricing for zero-car, one-car, and multi-car owning households.
- The sensitivity of car shedding to car-service pricing.  
This testing would hopefully give us some sense of whether the model is underestimating or overestimating the effect of car services on travel and whether driver adjustments need to be made as well as vehicle adjustments. Ideally there would be some studies in the literature that would provide some reference data to compare results with.

If the testing reveals that the number of drivers should be adjusted in addition to the number of vehicles, then I think the easiest way to accomplish that would be for users to modify the *region_hh_driver_adjust_prop.csv* values to make assumptions about how the proportion of "drivers" would be different in areas having high-level car services. To do this, the input file would need to have two sets of inputs (high-level car-service vs. not). The AssignDrivers code would also need to be changed to adjust household drivers differently depending on whether the household is located in a place having high level car service.

There is one other thing related to this item that I believe is important to do to improve the model. The current model swaps car service for household vehicles if car service cost per mile is lower than a vehicle ownership cost and if a uniform random probability draw (0-1) is less than the probability of substitution for the vehicle specified in the *azone_carsvc_characteristics.csv* file (AutoCarSvcSubProp, LtTrkCarSvcSubProp). It is likely that the marginal probability of substitution decreases as the number of vehicles owned by the household decreases. For example, a household that owns three cars will be more likely to substitute one of their cars than a household that owns only one car (all else being equal). To account for this effect, AdjustVehicleOwnership module could incorporate a weighting system in applying the AutoCarSvcSubProp and LtTrkCarSvcSubProp values in choosing which vehicles are substituted. The details of the weighting system need to be worked out.

## Item 2: Occupancy dials for owned and CarService vehicles.
> Occupancy dials for owned and CarService vehicles.  Current model implicitly assumes NHTS average occupancy, allow user to change this value.  How identify base value and source for reasonable alternative occupancy range?

### Discussion
The primary reason for this change is to enable the evaluation of the effect of shared car-service use on VMT and the associated impacts (e.g. congestion, emissions). Driverless vehicles and the routing algorithms that control them could enable car-services to operate as shared services where a vehicle could carry people who are not traveling together at a reduced fare. The deployment of shared car services could reduce VMT by increasing the average occupancy of car service trips.

A substantial challenge for modeling the effect of shared car services by adjusting 'occupany dials' is that the model has very limited information about vehicle occupancy. Modeling use of shared and unshared car services based on occupancy, would require information about the distribution of household VMT by vehicle occupancy and a method to allocate vehicle travel among household vehicles and car services in a manner that is sensitive to occupancy. Currently VisionEval does not model vehicle occupancy except for the calculation of shorter-length single-occupant vehicle tours that could be diverted to bicycle travel. Adding vehicle occupancy models to VisionEval would require a substantial amount of model development work.

Fortunately there is another way to satisfy the goal of modeling the potential effect of shared car services on VMT without modeling occupany. We can eliminate the need to explicitly model occupancy with the simplifying assumption that occupancy doesn't matter in the allocation of household travel among household vehicles and car services<sup>[6](#footnote6)</sup>. With that assumption, we don't need to know the amount of household travel by occupancy level or the likelihoods that travel by different occupancy levels would use different types of services and household vehicles. All we would need to do is add shared car service as a choice and include appropriate cost parameters to allocate the proportion of household VMT to shared car service. In addition, we would need to calculate adjustments to road miles of car services to account for increased occupancy of shared service and differences in out-of-direction and deadhead miles (shared services would increase out-of-direction travel to service multiple passengers but might reduce deadhead miles). As explained in more detail below, it will be necessary to carefully account for how the VMT is allocated because the difference in VMT that the household experiences (and used in the budget model) will not be the same as the difference on the roads. Using a shared service would probably increase the household's VMT because of out-of-direction travel, but travel on the roads and the environmental effects would be reduced because of the higher vehicle occupancy.

### Recommendations
Following is a more detailed description of the proposal for modeling shared car service use:
1. Modify the *bzone_carsvc_availability.csv* to add an input field for identifying whether shared service is available in each bzone.
2. Modify the inputs in *azone_carsvc_characteristics.csv* file to add fields to discriminate car service costs between shared and unshared services. In addition, add deadhead proportions for shared and non-shared car-services. Phase 1 added deadhead for high and low services. The changes would descriminate by shared vs. non-shared as well. This might just be a factor that would multiply the existing deadhead factors. This would account for the combination of difference in pure deadhead (unoccupied) and out-of-direction travel to serve multiple destinations. 
3. Modify the *azone_vehicle_access_times.csv* file to discriminate between access times for shared and unshared car services. The assumed estimate for shared car services would include the added trip time needed to serve multiple passenger destinations.
4. Add a factor which specifies the proportional increase in passenger destinations (i.e. average proportional increase in occupancy) for shared vs. unshared car services. For example, a value of 2 means that on average a shared car service is serving 2 travel parties at the same time. This might be added to the *azone_carsvc_characteristics.csv* file or be a regional parameter.
5. The process of calculating vehicle operating costs in the *CalculateHhVehicleOperatingCost* module, would add a step for calculating average car service cost. In this step, the Cobb-Douglas utility function would be applied at the Bzone level to calculate the proportional split of VMT between shared and unshared car-services. These proportions would then be used to calculate average car-service out-of-pocket and composite costs to use in the allocation of household VMT between owned and car-service vehicles and the average cost per mile of household travel. 
6. Calculate a factor to adjust car service VMT to account for change in average occupancy given the assumed factor (#4) and the calculated split between shared and unshared services. For example, if the assumed factor is 2 and if the calculated split is 50:50, then the average occupancy increase is 1.5 and the VMT adjustment factor is 2/3.
7. Modify the calculation of car-service deadhead proportion to account for the split between shared and unshared car-services and the respective deadhead values.
8. Modify the calculation of household impacts to account for the occupancy factor (#6) as well as the deadhead factor (#7). These affect the calculation of environmental and revenue impacts of household travel but don't affect household costs.

I also think there is another change that needs to be made to the method for allocating travel among household vehicles and car service. The current method for allocating VMT among household vehicles and car services works on vehicles in the vehicle table. The process for making the vehicle table adds car service entries to fill out the records for each household so that the number of records equals the number of driving age persons in the household. This means that for some households, there will be multiple car share vehicle entries, all of which will receive an allocation of travel. This is incorrect because car service is one choice for allocating travel to, not multiple choices. The approach should be changed to that of a sequential nested structure where the top level allocates VMT between household vehicles as a group and car services as a group. A second level then allocates VMT among household vehicles and among car service 'vehicles'.

## Items 3 & 9: Inputs limiting “driverless” to selected powertrains. Replace random assignment of which HHs get AVs.   
> 3. Inputs limiting “driverless” to selected powertrains.  This might be an easy non-combustion engine toggle, or expanding the planned 2 value input to 6.
> 9. Replace random assignment of which HHs get AVs. Current input is X% of vehicles are AV in model year XXXX. Borrow HH index trick from PAYD module, where HH attributes weight the likelihood of the AV assignment. (e.g., given input that 5% vehicles made in 2030 are assumed AV, index gives higher probability that AVs go to EV vehicles of that year and HHs with teenagers, and longer commutes, exact attributes in index determined by lit review/survey data).

### Discussion
The proportion of owned driverless vehicles is specified as an input by vehicle model year and type in the *region_driverless_vehicle_prop.csv* file. The driverless characteristic is then allocated to household vehicles in each age/type group randomly with no weighting.

The objective in item 9 is to assign driverless vehicles according to some weighting scheme based on attributes believed to be important to the choice of which households are more likely to have driverless vehicles and which vehicles are more likely to be driverless. The AssignDriverlessVehicles module would be changed to use a method similar to that used by the CalculateVehicleOwnCost module to assign which households use pay-as-you-drive (PAYD) insurance. That module uses a weighted sampling process in which household weights are calculated from weights assigned to various household attributes. As noted above in the recommendations for issue #1, households composed of elderly persons could be one of the weighting factors.

The objective in item 3 is substantially more difficult because vehicle powertrain is assigned much later in the model sequence when the AssignHhVehiclePowertrain module is run; after all the VEHouseholdVehicle modules and VEHouseholdTravel modules are run. Thus vehicle powertrain is not known when driverless vehicle assignments are made. Moving the AssignHhVehiclePowertrain module to run after the AssignHhVehiclePowertrain module would be problematical because driverless vehicle assignments for elderly households are important to the calculation of drivers and VMT for those households (see item #1 recommendations above).

An alternate way to achieve the objective would be to flip the wording of the objective as follows - *add driverless vehicle status as a criterion for assigning vehicle powertrain*. The user would specify whether driverless vehicle status is to be used in the powertrains assignment process. The powertrain assignment process proceeds in the order of assigning BEVs, then PHEVs, then HEVs, and finally ICEVs. If user identifies that the driverless vehicle attribute is to be used in the assignment process, powertrains would be assigned to driverless vehicles in that priority order. 

## Recommendation
Modify the AssignDriverlessVehicles module to implement a weighting scheme for assigning driverless vehicles similar to the method used to identify PAYD insurance households as follows:
1. Identify household and vehicle attributes that are believed to affect which vehicles are most likely to be driverless. Elderly households should be one of the attributes in order to satisfy the recommendations for item #1. Develop recommended weights for each attribute. Create a new input file to hold the recommended weights. Because this is an input file, the model user can modify the weights.
2. Modify the module specifications for AssignDriverlessVehicles module to specify the input file above in the *Inp* specifications. Modify the *Get* specifications to retrieve those weights and to also to retrieve all of the household and vehicle datasets needed to apply the weights.
3. Modify the AssignDriverlessVehicles function code to calculate the weights assigned to each vehicle and to use the weights in the stochastic choice process. The PAYD function code can serve as a template for this.

Modify the AssignHhVehiclePowertrain module to use the driverless vehicle attribute in the assignment of vehicle powertrains as follows:
1. Define an input for users to specify whether driverless vehicle status is to be used in assigning powertrains. This may require the specification of a new input file.
2. Modify the module specifications for the AssignHhVehiclePowertrain module to specify the input file above in the *Inp* specifications. Modify the *Get* specifications to retrieve the value for the input identifying whether driverless vehicles are to be used in identifying powertrain. Also modify the *Get* specifications to retrieve the driverless attribute.
3. Modify the code in the AssignHhVehiclePowertrain function so that if driverless vehicles are to be used in the assignment, those vehicles are given priority in the assignment process.

## Item 4: Add a driverless vehicle maintenance (per mile) operating cost surcharge.
 > Add a driverless vehicle maintenance (per mile) operating cost surcharge.  This would reflect the cost to keep the software and AV technology in top condition.  Source for additional costs?

### Background and Discussion
Vehicle maintenance and repair costs are model parameters estimated from AAA and BLS data. They vary by vehicle age, type, and powertrain. No distinction is made in the cost of driverless vehicles.

A driverless vehicle maintenance and repair cost surcharge could be added as a model input but a better approach might be to have a maintenance/repair adjustment factor for driverless vehicles. The maintenance/repair cost for driverless vehicles would be calculating by multiplying the base maintenance/repair cost for the vehicle type and age by the factor. Some guidance would need to be provided to the user on reasonable values to use. It should be considered that perhaps driverless vehicles could have lower vehicle maintenance and repair costs because they could operate in ways that reduce those costs. If, for example, driverless vehicles reduce the likelihood of crashes, repair cost would go down. In that case, the factor would have a value less than one. If however the net maintenance/repair cost for driverless vehicles would be greater because of the high cost of maintaining and repairing complex sensors and computers, then the factor would have a value greater than one.

### Recommendations
Implement a driverless vehicle maintenance surcharge as follows:
1. Add a driverless maintenance/repair cost adjustment input factor as an input. This might be included in the same input file as the driverless priority flag for assigning powertrains described in the recommendations for implementing item #3 above. Develop user guidance on reasonable values. This input file could be processed when the AssignDriverlessVehicles module is run.
2. Modify the CalculateVehicleOperatingCost module Get specification to read in this factor. Change the CalculateHhVehicleOperatingCost code to use the factor to adjust the base maintenance/repair cost to calculate that cost for driverless vehicles.

## Item 5: Tabulate/enable output measure of overall Car Service impact to lend realism.
> Tabulate/enable output measure of overall Car Service impact to lend realism.  Identify total and share of car service miles, number of households using Car Service (currently able?) and/or the number of CarService vehicles (i.e., for parking demands)

### Discussion
The model assigns car service VMT to each household. In addition, it identifies the proportion of that VMT that is deadhead vs. service miles. These data can be used to calculate the total and share of car service miles and number of households using car service. What the model does not do is calculate the size of the car service fleet that would be necessary to provide the modeled household service. Developing a car service fleet model will require researching the literature to determine the relationship between demand and fleet size. Perhaps some of the modeling studies that have been done by researchers at UT Austin on driverless car services would provide some guidance. Data on TNC fleet sizes and miles driven might also be useful, but are likely to overestimate the necessary fleet size.

### Recommendations
Calculating car service fleet size probably can be done without any substantial changes to existing modules. The calculation is likely to be simple. The tough part will be to figure out a sensible relationship between the car service fleet size and the number of households served and amount of their car service travel. That could require a significant amount of research. Once a factor or factors are calculated, the fleet size could be calculated by marea in the CalculateHhVehicleOperatingCost module and saved in the datastore as an marea dataset.

## Items 6 and 10: Be able to model varying car service pricing schemes
> Car Service rate structure – add fixed rate to per mile rate.
> Be able to consider (model) varying shared price schemes such as:
  - Per mile charge
  - Public-private shared model, where TNCs help to supplement or replace transit with the option at a flat / subsidized fare.
  - Subscription plans with unlimited miles.

### Discussion
Car service pricing is on a per mile basis. This feeds into the calculation of vehicle costs used to allocate travel between vehicles and to adjust household travel to fit into the household budget. As described above, the per mile composite cost rates of travel by each vehicle (including car services) are used to allocate travel between vehicles. Based on that allocation and the respective out-of-pocket costs an average out-of-pocket cost per mile is calculated for each household. That average cost is used to adjust the household VMT to fit in the household budget.

Any pricing scheme needs to be translateable into a cost per mile in order to fit into the current model approach. Changing the model approach is not possible without major rewrites.

### Recommendations
I suggest that some guidance be developed for preprocessing alternative pricing schemes to calculate per mile rates that are consistent with the pricing scheme. This might require working backwards, carrying out a number of model runs at a range of per mile prices and using the resulting information to identify equivalent alternative pricing schemes. This could be used to calculate flat/subsidized fares. Very low mileage rates would be equivalent to subscription plans with unlimited miles. Research would need to be done on the supply side to determine what might be the lowest possible fare.

## Item 7: Allow policy that taxes zero-passenger vehicle miles (owned or CarService)
> Allow policy that taxes zero-passenger vehicle miles (owned or CarService). Would require separating out base amount of zero-passenger miles, and an ability to substitute between zero and non-zero miles. For car services, zero-passenger miles are miles traveled without a customer (same as deadhead miles). For owned vehicles, zero-passenger miles are miles traveled without any occupants.

### Discussion
The VMT traveled by vehicles not carrying passengers could become a substantial portion of all passenger car VMT if driverless vehicles and car service increase greatly. For example, it has been found that a large portion of VMT of Uber and Lyft vehicles is by vehicles that are not carrying a passenger. Zero-passenger mileage could also be large for household-owned driverless vehicles if households operate them remotely do things such as sending them to remote parking spaces that are free, and sending them to another household member for their use.

Since the model calculates deadhead mileage and added mileage due to remote access, it would be a straightforward matter to apply a tax to that mileage. This would be done in the CalculateVehicleOperatingCost module. 

### Recommendations
The following things can be done to allow taxation of zero-passenger vehicle miles to be modeled:
1. Modify the *azone_veh_use_taxes.csv* file to include 2 additional mileage taxes: tax on the deadhead travel of car services, and tax on unoccupied vehicle travel of household vehicles. Provide guidance on a reasonable range of values for these inputs.
2. Modify the specifications for the CalculateVehicleOperatingCost module to process these added input values and to retrieve them from the datastore for use in the calculations.
3. Modify the CalculateVehicleOperatingCost function code, after added deadhead mileage and remote access mileage has been computed, calculate the respective taxes on that travel. Add other vehicle taxes to those taxes to get a total tax for each vehicle and then calculate an average tax rate per mile for each vehicle. Use this in subsequent calculations.

## Item 8: Expand the revenue generation reporting from the model
> Expand the revenue generation reporting from the model.  Sources and amounts. (could do much with existing outputs, might also need to save intermediate outputs)  

### Discussion
The model tabulates revenues to balance total vehicle charges and revenues but it does not save any of the results of intermediate calculations by revenue source.

### Recommendations
It would be fairly easy to change the code to save the intermediate calculations of revenue by source in the datastore. This would be done by modifying the CalculateVehicleOperatingCost code: modifying the module Set specifications and the output list produced by the module function. Changes are needed to the CalculateVehicleOwnCost module, AdjustVehicleOwnership module, and the BalanceRoadCostsAndRevenues module as well. The CalculateVehicleOwnCost module should be changed to save the calculated ownership taxes in the vehicle table of the datastore. The AdjustVehicleOwnership module should be changed to remove the vehicle ownership tax entries for vehicles that are changed from owned vehicles to car service, and the resulting vehicle ownership taxes should be summed by household and saved to the datastore. The BalanceRoadCostsAndRevenues module should be changed to load the vehicle ownership taxes and use them in the calculation of total road tax reciepts.

## Footnotes
<a name="footnote1">1</a> https://github.com/gregorbj/VisionEval-Dev/tree/development/sources/modules/VEHouseholdTravel/inst/module_docs  
<a name="footnote2">2</a> https://github.com/VisionEval/VisionEval/blob/master/sources/modules/VETravelDemandMM/inst/module_docs/CalculateHouseholdDVMT.md  
<a name="footnote3">3</a> Car services include taxis, transportation network companies (e.g. Uber, Lyft), and car-sharing companies (e.g. car2go, Zipcar). High-level car services are those whose access times are comparable to the access time for using an owned vehicle. Access time includes the time for the traveler to get to the vehicle or the vehicle to get to the traveler at the start of the trip, the time to park the vehicle at the end of the trip (if relevant), and the time to get from the vehicle to the trip destination at the end of the trip. The level of car service is identified in VE-RSPM models by bzone in the *bzone_carsvc_availability.csv* input file and in VE-State models by area type in the *marea_carsvc_availability.csv* input file.
<a name="footnote4">4</a> The CalculateHouseholdDVMT module is called to make an initial estimate of household DVMT for this purpose.  
<a name="footnote5">5</a> Commercial service travel is travel by light-duty vehicles providing commercial services such as deliveries.  
<a name="footnote6">6</a> Whether or not this simplifying assumption is reasonable deserves investigation. Given my limited knowledge at this time it seems to be reasonable for a couple of reasons. First, household travelers whether alone or in groups would experience the same relative cost benefits of using a shared service. Second, I can't think of a reason that people would would be more likely to use a shared service depending on number of household members in the party. On the one hand, it might be easier to get a shared ride as a single traveler. On the other hand, a single traveler might be more concerned about traveling with strangers.

